import numpy as np
import tkinter as tk
from tkinter import ttk, messagebox

def calculate_cutoff_thickness(wavelength, n2, n1=1.45, n3=1.0):
    """
    Calculate the cut-off thickness for an organic laser waveguide, TE0 mode only. 
    
    Parameters:
    wavelength (float): The wavelength (λ₀) in nanometers
    n2 (float): Refractive index of organic gain medium layer
    n1 (float): Refractive index of glass substrate (default: 1.45)
    n3 (float): Refractive index of air (default: 1.0)
    
    Returns:
    float: Cut-off thickness (h_c) in nanometers
    """
    try:
        # Validate inputs
        if n2 <= n1 or n1 <= n3:
            raise ValueError("Refractive indices must satisfy n2 > n1 > n3")
        if wavelength <= 0:
            raise ValueError("Wavelength must be positive")
            
        # Calculate terms inside the equation
        term1 = wavelength / (2 * np.pi * np.sqrt(n2**2 - n1**2))
        term2 = np.arctan(np.sqrt((n1**2 - n3**2)/(n2**2 - n1**2)))
        
        # Calculate cut-off thickness
        h_c = term1 * term2
        
        return h_c
    except ValueError as e:
        raise e
    except Exception as e:
        raise ValueError(f"Calculation error: {str(e)}")

class CutoffCalculatorGUI:
    def __init__(self):
        # Set up the main window
        self.root = tk.Tk()
        self.root.title("Organic Laser Cut-off Thickness Calculator")
        
        # Get screen dimensions
        screen_width = self.root.winfo_screenwidth()
        screen_height = self.root.winfo_screenheight()
        
        # Calculate window size (scaled for 4K)
        window_width = int(screen_width * 0.3)  # 30% of screen width
        window_height = int(screen_height * 0.4)  # 40% of screen height
        
        # Center the window
        x = (screen_width - window_width) // 2
        y = (screen_height - window_height) // 2
        self.root.geometry(f"{window_width}x{window_height}+{x}+{y}")
        
        # Configure style
        self.style = ttk.Style()
        self.style.configure('TFrame', background='#f0f0f0')
        self.style.configure('TLabel', background='#f0f0f0', font=('Calibri', 18))
        self.style.configure('TButton', font=('Calibri', 18), padding=10)
        self.style.configure('TEntry', font=('Calibri', 18))
        
        self.create_widgets()

    def create_widgets(self):
        # Create main frame
        main_frame = ttk.Frame(self.root, padding="20")
        main_frame.pack(fill='both', expand=True)
        
        # Title
        title_label = ttk.Label(main_frame, 
                              text="Organic Laser Cut-off Thickness Calculator (TE0)",
                              font=('Calibri', 22))
        title_label.pack(pady=10)
        
        # Input frame
        input_frame = ttk.Frame(main_frame)
        input_frame.pack(padx=10, pady=10, fill='x')
        
        # Wavelength input
        wavelength_label = ttk.Label(input_frame, text="Wavelength (nm):")
        wavelength_label.pack(pady=5)
        self.wavelength_entry = ttk.Entry(input_frame)
        self.wavelength_entry.pack(pady=5, ipady=5)
        
        # n2 input
        n2_label = ttk.Label(input_frame, text="n₂ (organic medium):")
        n2_label.pack(pady=5)
        self.n2_entry = ttk.Entry(input_frame)
        self.n2_entry.pack(pady=5, ipady=5)
        
        # Fixed values display
        fixed_values_frame = ttk.Frame(main_frame)
        fixed_values_frame.pack(padx=10, pady=10, fill='x')
        
        fixed_values_text = "Fixed Values:\nn₁ (glass) = 1.45\nn₃ (air) = 1.0"
        fixed_values_label = ttk.Label(fixed_values_frame, text=fixed_values_text)
        fixed_values_label.pack(pady=5)
        
        # Calculate button
        self.calc_button = ttk.Button(main_frame, 
                                    text="Calculate",
                                    command=self.calculate)
        self.calc_button.pack(pady=10)
        
        # Result display
        self.result_label = ttk.Label(main_frame, text="", font=('Calibri', 16))
        self.result_label.pack(pady=10)

    def calculate(self):
        try:
            # Get and validate inputs
            wavelength = float(self.wavelength_entry.get())
            n2 = float(self.n2_entry.get())
            
            # Calculate result
            result = calculate_cutoff_thickness(wavelength, n2)
            
            # Display result
            self.result_label.configure(
                text=f"Cut-off thickness: {result:.2f} nm"
            )
            
        except ValueError as e:
            messagebox.showerror("Error", str(e))
        except Exception as e:
            messagebox.showerror("Error", f"An error occurred: {str(e)}")

    def run(self):
        self.root.mainloop()

if __name__ == "__main__":
    app = CutoffCalculatorGUI()
    app.run()
